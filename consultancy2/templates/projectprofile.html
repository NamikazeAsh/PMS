{% extends temp %}
{% load static %}

{% block extracss %}
<style>
 @import url('https://fonts.googleapis.com/css2?family=DM+Serif+Display&display=swap');
  @import url('https://fonts.googleapis.com/css2?family=PT+Serif:wght@400;700&display=swap');

  .h1 {
    font-family: 'PT Serif', serif;
    font-size: 2.55rem;
    line-height: 2.6rem;
    letter-spacing: -0.063px;
  }

  h2 {
    font-family: 'PT Serif', serif;
    font-size: 1.9rem;
    line-height: 2.6rem;
    letter-spacing: -0.063px;
    font-weight: 700;
    padding-top: 48px;
  }

  p {
    font-family: 'PT Serif', serif;
    line-height: 2rem;
    font-size: 1.3rem
  }

  @media screen and (min-width: 600px) {
    .children form {
      margin-left: -48px;
      /* will touch very left side */
    }

    .children .children form {
      margin-left: -96px;
      /* will touch very left side */
    }
  }

  .avatar_comment,
  .avatar_single {
    height: 48px;
    width: 48px;
    background-color: #000;
    border-radius: 50%;
    display: inline-block;

  }

  .smaller {
    font-size: 0.8rem;
  }

  .thumb-active {
    fill: blue
  }

  .comment-add {
    border-bottom: 1px solid #ccc !important;
  }

  .comment-add:focus {
    border-color: #1497ff;
    box-shadow: inset 0 0px 0px rgba(0, 0, 0, 0.075), 0 0 0px rgba(255, 0, 0, 0.6);
  }

  .node-content {
    padding-left: 64px;
  }

</style>
{% endblock extracss %}

{% block extrascripts %}
<script>
  function formExit() {
    document.getElementById("newForm").remove();
  }

  function myFunction(id) {
    if (document.contains(document.getElementById("newForm"))) {
      document.getElementById("newForm").remove();
    }

    var d1 = document.getElementById(id);
    d1.insertAdjacentHTML('afterend',
      '<form id="newForm" class="form-insert py-2" method="post"> \
                  <div class="d-flex justify-content-between"><h3>Reply:</h3><div><button type="button" class="btn btn-outline-secondary" onclick="formExit()"">Close</button></div></div> \
                  <select name="parent" class="d-none" id="id_parentt"> \
                  <option value="' + id + '" selected="' + id + '"></option> \
                  </select> \
                  <label for="id_content">Content:</label> \
                  <textarea name="content" cols="0" rows="1" class="ml-3 mb-3 form-control border-0 comment-add rounded-0" required id="id_content" placeholder="Add a comment"></textarea> \
                  {% csrf_token %} \
                  <button type="submit" class="btn btn-primary btn-lg btn-block">Submit</button> \
                </form>');

    //document.querySelector('#id_parentt [value="' + id + '"]').selected = true;
  }

  $('#myForm').trigger("reset");
</script>


{% endblock extrascripts %}

{% block content %}
<div style="height:216px; background-color: #624bff; ">
<div class="container-fluid">
  <div id="ui-view" style="opacity: 1;">
    <div class="animated fadeIn">
      <div class="row">
        <div class="col-12 mb-3">
          <div class="social-box" style="height:110%">

            <!-- <img src="{{user_view.img.url }}" class="img-avatar m-4" alt="{{ user_view }}" width="20%"> -->

            <br><br><br><br><br>
            {% for projname in projdet %}
            <h1 style="font-size: 40px;">{{projname.name}}</h1>
            {% endfor %}


          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <div class="card mt-5">
            <div class="simple-box">
              <br><br><br>
              <h2 style="text-align: center;">Project details</h2>
              <br><br><br>
              <table class="table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Project Name</th>
                    <th>Category</th>
                    <th>Status</th>
                    <th>Added date</th>
                    <th>Dead line</th>
                    <th>Company</th>
                    <th>Description</th>

                  </tr>
                </thead>
                <tbody>
                  {% for project in projdet %}
                  <tr>
                    <td>{{ project.id }}</td>
                    <td>{{ project.name }}</td>
                    <td>
                      {% if project.category == '1' %}Extension Based
                      {% elif project.category == '2' %}Functional Based
                      {% elif project.category == '3' %}Research Based
                      {% elif project.category == '4' %}Government
                      {% endif %}
                    </td>
                    <td>
                      {% if project.status == '1' %}
                      Working
                      {% elif project.status == '2' %}
                      Stuck
                      {% elif project.status == '3' %}
                      Done
                      {% endif %}
                    </td>
                    <td>{{ project.add_date }}</td>
                    <td>{{ project.dead_line }}</td>
                    <td>{{ pcname }}</td>
                    <td>{{ project.description }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
              <br><br><br>
              <h2 style="text-align: center;">Team Members</h2>
              <br><br><br>
              <table class="table">
                <thead>
                  <th>Members</th>
                  <th>Team Name</th>
                </thead>
                <tbody>

                  <tr>
                    {% for member in team_members %}
                    {% for name in team_name %}

                    <td> {{member}} </td>
                    <td> <b>{{name}}</b> </td>

                  </tr>
                  {% endfor %}
                  {% endfor %}
                </tbody>


              </table>



              <br><br><br>
              <h2 style="text-align: center;">Finances</h2>
              <br><br><br>
              <table class="table">
                <thead>
                  <th>Total Cost(Before GST and TDS)</th>
                  <th>Percentage to Christ University</th>
                  <th>Cost to Christ University</th>
                  <th>Professors</th>
                  <th>Job Cost Ratio</th>
                </thead>
                <tbody>

                  <tr>
                    {% comment %} {% for member in team_members %}
                    {% for name in team_name %}
                    <td> {{member}} </td>
                    <td> <b>{{name}}</b> </td> {% endcomment %}

                    <td>{{financeDetails.amtreceived}}</td>
                    <td>{{financeDetails.cupercentage}}</td>
                    <td>{{cuShare}}</td>
                    <td>{{profNames}}</td>
                    <td>{{profRatio}}</td>

                  </tr>
                  {% comment %} {% endfor %}
                  {% endfor %} {% endcomment %}
                </tbody>


              </table>


              <br><br><br>
              <h2 style="text-align: center;">Detailed Finances</h2>
              <br><br><br>
              <table class="table">
                <thead class="thead-dark">
                  <th><b>Particular</b></th>
                  <th></th>
                  <th><b>Amount</b></th>
                  <th></th>
                </thead>
                <tbody>

                  <tr class="text-muted">
                    <td>Total amount received excluding GST and TDS</td>
                    <td></td>
                    <td><b>{{financeDetails.amtreceived}}</b></td>
                    <td>
                    </td>
                  </tr>

                  <tr  class="text-muted">
                    <td>{{financeDetails.cupercentage}}% to Christ University</td>
                    <td>{{cuShare}}</td>
                    {% comment %} <td>{{financeDetails.cupercentage}} * {{financeDetails.amtreceived}}</td> {% endcomment %}
                    <td style="width:fit-content;">
                      {% comment %} <button type="button" class="btn btn-warning"><img src="{% static " /icons/edit.svg" %}"></button>
                      <button type="button" class="btn btn-danger"> <img style="width:80%" src="{% static "/icons/delete.svg" %}"></button> {% endcomment %}
                    </td>
                  </tr>

                  <tr>
                    <td><b>Less: Expenses incurred on the file</b></td>
                    <td></td>
                    <td></td>
                    <td></td>
                  </tr>

                  {% for expense in expenseDetails %}
                  <tr class="text-muted">
                      <td>{{expense.particular}}</td>
                      <td>{{expense.amount}}</td>
                      <td></td>
                      <td>
                        <img src="{% static "icons/edit.svg" %}"  data-bs-toggle="modal" data-bs-target="#editExpenseModal{{expense.id}}" style="cursor: pointer;"></img>
                        <a href="/projects/projects/edit_task/{{tk.id}}" class="btn btn-danger ml-4"><img src="{% static "icons/delete.svg" %}" style="cursor: pointer;"></img></a>
                      </td>
                  </tr>
                  {% include 'editExpenseModal.html' with projectid=pid thisExpenseId=expense.id thisExpenseParticular=expense.particular thisExpenseAmount=expense.amount %}
                  {%endfor%}

                  <tr>
                    <td><b>Total Expenses</b></td>
                    <td></td>
                    <td><b>{{totalExpense}}</b></td>
                    <td></td>
                  </tr>

                  <tr>
                    <td><b>Add: Incomes incurred on the file</b></td>
                    <td></td>
                    <td></td>
                    <td></td>
                  </tr>

                  {% for income in incomeDetails %}
                  <tr class="text-muted">
                    <td>{{income.particular}}</td>
                    <td>{{income.amount}}</td>
                    <td></td>
                    <td>
                      <img src="{% static "icons/edit.svg" %}"  data-bs-toggle="modal" data-bs-target="#editIncomeModal{{income.id}}" style="cursor: pointer;"></img>
                      <a href="/projects/projects/edit_task/{{tk.id}}" class="btn btn-danger ml-4"><img src="{% static "icons/delete.svg" %}" style="cursor: pointer;" ></img></a>
                    </td>
                  </tr>
                  {% include 'editIncomeModal.html' with projectid=pid thisIncomeId=income.id thisIncomeParticular=income.particular thisIncomeAmount=income.amount%}
                  {%endfor%}

                  <tr>
                    <td><b>Total Incomes</b></td>
                    <td></td>
                    <td><b>{{totalIncome}}</b></td>
                    <td></td>
                  </tr>                 

                  <tr>
                    <td><b>Net amount availabe for Disbursement</b></td>
                    <td></td>
                    <td><b>{{netAmount}}</b></td>
                    <td></td>
                  </tr>
 
                  {% for prof in profDetails %}
                  <tr class="text-muted">
                    <td class="text-dark">{{prof.Professor}} (Ratio: {{prof.ratio}}/10)
                     <p class="m-0 text-muted" style="font-size:.8rem;">{{prof.desc}}</p>
                    </td>
                    <td></td>
                    <td>{{prof.ratioAmount}}</td>
                    <td>
                      <img src="{% static "icons/edit.svg" %}" data-bs-toggle="modal" data-bs-target="#editProfessorModal{{prof.id}}" style="cursor: pointer;"></img>
                      <a href="/projects/projects/edit_task/{{tk.id}}" class="btn btn-danger ml-4"><img src="{% static "icons/delete.svg" %}" style="cursor: pointer;"></img></a>
                      </td>
                  </tr>
                  {% include 'editProfessorModal.html' with projectid=pid thisProfId=prof.id thisProfName=prof.Professor thisprofRatio=prof.ratio thisProfDescription=prof.desc %}
                  {%endfor%}
                  

                </tbody>


              </table>

              <button type="button" class="btn btn-outline-primary" style="margin-bottom: 1rem; margin-left: 1rem;" data-bs-toggle="modal" data-bs-target="#addExpenseModal">Add Expense</button>
              {% comment %} <a href="/projects/project/{{project.id}}/addincome"> {% endcomment %}
                <button type="button" class="btn btn-outline-primary" style="margin-bottom: 1rem; margin-left: 1rem;" data-bs-toggle="modal" data-bs-target="#addIncomeModal">Add Incomes</button>
              {% comment %} </a> {% endcomment %}
              <button type="button" class="btn btn-outline-primary" style="margin-bottom: 1rem; margin-left: 1rem;" data-bs-toggle="modal" data-bs-target="#editBasicFinanceInfoModal">Edit Basic Information</button>
              <button type="button" class="btn btn-outline-primary" style="margin-bottom: 1rem; margin-left: 1rem;" data-bs-toggle="modal" data-bs-target="#addProfessorModal">Add Professor</button>

            </div>
            
          </div>
        </div>
        
          {% include 'basicFinanceInfoModal.html' with projectid=pid %}
          {% include 'addProfessorModal.html' with projectid=pid %}
          {% include 'addIncomeModal.html' with projectid=pid %}
          {% include 'addExpenseModal.html' with projectid=pid %}


        

        <div class="container-fluid">
          <div id="ui-view" style="opacity: 1;">
            <div class="animated fadeIn">
              <div class="row">
                <div class="col-12 mb-3">
                  <div class="social-box" style="height:110%">

                    <!-- <img src="{{user_view.img.url }}" class="img-avatar m-4" alt="{{ user_view }}" width="20%"> -->

                    <br><br><br><br><br>
                     <div class="container">
                      <div class="row justify-content-md-center pt-5">

                        <div class="col-md-7">

                          {% with allcomments.count as total_comments %}
                          <h2>
                            {{ total_comments }} comment{{ total_comments|pluralize }}
                          </h2>
                          {% endwith %}

                          {% load mptt_tags %}

                          <div>
                            {% recursetree comments %}
                            <div id="{{ node.id }}" class="my-2 p-2" style="border: 1px solid grey">
                              <div class="d-flex justify-content-between">By {{ node.username }}<div></div>{{node.date_time }}</div>
                              <div>{{ node.content }}</div>
                              <div class="d-flex flex-row-reverse">
                              {% if node.level < 3 %} <button class="btn btn-primary btn-sm" onclick="myFunction({{node.id}})">Reply</button>
                              <button class="btn btn-outline-secondary btn-sm mr-2"><a href="/projects/projects/deletecomment/{{node.id}}">Delete</a></button>
                                {% endif %}
                            </div>
                            <hr>
                            </div>
                            {% if not node.is_leaf_node %}
                            <div class="children pl-2 pl-md-5">
                              {{ children }}
                            </div>
                            {% endif %}
                            {% endrecursetree %}
                          </div>

                          <div class="py-4">
                            <nav aria-label="Page navigation example">
                              {% if comments.has_other_pages %}
                              <ul class="pagination">
                                {% if comments.has_previous %}
                                <li class="page-item"><a class="page-link"
                                    href="?page={{ comments.previous_page_number }}">Previous</a>
                                </li>
                                {% else %}
                                <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                                {% endif %}
                                {% for num in comments.paginator.page_range %}
                                {% if comments.number == l %}
                                <li class="page-item active"><span class="page-link">{{ num }} <span
                                      class="sr-only">(current)</span></span>
                                </li>
                                {% else %}
                                <li><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
                                {% endif %}
                                {% endfor %}
                                {% if comments.has_next %}
                                <li class="page-item"><a class="page-link"
                                    href="?page={{ comments.next_page_number }}">Next</a></li>
                                {% else %}
                                <li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
                                {% endif %}
                              </ul>
                              {% endif %}
                            </nav>
                          </div>

                          <div id="myDIV" style="display:block;">
                            <form id="myForm" method="post">
                              <h2>Create new comment</h2>
                              {{ comment_form.as_p }}
                              {% csrf_token %}
                              <button type="submit" class="btn btn-primary btn-lg btn-block">Submit</button>
                            </form>
                          </div>

                        </div>
                      </div>
                    </div> 



                  </div>
                </div>
              </div>


            </div>
          </div>
        </div>
      </div>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>



    {% endblock %}